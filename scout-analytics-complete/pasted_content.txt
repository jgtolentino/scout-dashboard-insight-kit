To fully integrate **OpenAI via Azure** into your mock Scout Analytics environment and **mimic Databricksâ€™ AI BI Genie (e.g., StockBot on Groq)**, youâ€™ll need:

---

## ğŸ¯ GOAL

An **AI-augmented BI system** where your mock dashboard:

* Accepts natural language queries
* Runs semantic search or SQL synthesis
* Calls OpenAI (via Azure OpenAI)
* Returns chart-ready responses

This will **mimic**:
âœ… Databricksâ€™ Genie
âœ… Groq-powered Stockbot
âœ… LangChain/AutoSQL BI agents

---

## âœ… SYSTEM COMPONENTS

| Layer             | Tool / Stack                                       |
| ----------------- | -------------------------------------------------- |
| **Frontend**      | Vite + React (already in ZIP)                      |
| **API Gateway**   | FastAPI or Express.js                              |
| **Model Access**  | Azure OpenAI (GPT-4 or GPT-4o via REST API)        |
| **Database**      | SQLite or Azure SQL (seeded from your CSVs)        |
| **Orchestration** | Custom: mimic StockBotâ€™s natural-to-SQL agent      |
| **Prompt Layer**  | System prompt to structure questions + SQL intents |

---

## ğŸ§  SYSTEM PROMPT (Databricks Genieâ€“style)

```txt
You are ScoutBot, a retail BI assistant. Translate user questions into optimized SQL queries for Azure SQL. 

- Database has tables: transactions, transaction_items, products, stores, customers
- Return JSON response or SQL with annotations
- Handle filters like: "last 7 days", "Region 4", "Oishi SKUs", "top brands by revenue"

ALWAYS output:
1. Interpreted intent
2. SQL
3. Chart recommendation (bar, line, pie)
```

---

## ğŸ”§ IMPLEMENTATION GUIDE

### âœ… 1. Azure OpenAI Key Setup

In your `.env`:

```env
AZURE_OPENAI_API_KEY=sk-...
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
AZURE_DEPLOYMENT_NAME=gpt-4
```

---

### âœ… 2. Create `ask.py` (FastAPI Route)

```python
from fastapi import FastAPI, Request
import openai
import os

openai.api_key = os.getenv("AZURE_OPENAI_API_KEY")
openai.api_base = os.getenv("AZURE_OPENAI_ENDPOINT")
openai.api_type = 'azure'
openai.api_version = '2023-07-01-preview'

app = FastAPI()

@app.post("/api/ask")
async def ask(request: Request):
    body = await request.json()
    user_query = body.get("query")

    response = openai.ChatCompletion.create(
        engine=os.getenv("AZURE_DEPLOYMENT_NAME"),
        messages=[
            {"role": "system", "content": "You are ScoutBot, a SQL assistant..."},
            {"role": "user", "content": user_query}
        ]
    )

    return response.choices[0].message["content"]
```

---

### âœ… 3. Frontend (React) Integration

```js
const askQuestion = async (query) => {
  const res = await fetch("/api/ask", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query })
  });
  const data = await res.text();
  setResponse(data);
};
```

---

### âœ… 4. Execute SQL Against Your Local DB (Optional)

You can add a second API:

```python
@app.post("/api/sql")
async def run_sql(request: Request):
    sql = (await request.json()).get("sql")
    conn = sqlite3.connect("mock.db")
    cursor = conn.cursor()
    result = cursor.execute(sql).fetchall()
    return {"rows": result}
```

---

### ğŸ“ Final Structure

```
/mock_ai_bi_genie/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ ask.py
â”‚   â”œâ”€â”€ sql.py
â”‚   â””â”€â”€ db_init.py (optional)
â”œâ”€â”€ .env
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ App.jsx (with /api/ask)
â”œâ”€â”€ seed/
â”‚   â””â”€â”€ transactions.csv, etc.
```

---

## ğŸ§° Want Me To Generate This For You?

* âœ… `ask.py` Azure OpenAI connector
* âœ… System prompt (ScoutBot style)
* âœ… React â†’ `/api/ask` integration
* âœ… Optional: SQLite backend with `run_sql`

Just say `generate full AI BI Genie mock bundle` and Iâ€™ll drop the code and scripts in one go.
